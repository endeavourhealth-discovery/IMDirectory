{
  "Q_RegisteredGMS": {
    "http://endhealth.info/im#definition": "{\n      \"@id\": \"http://endhealth.info/im#Q_RegisteredGMS\",\n      \"name\": \"Patient\",\n      \"description\":\n      \"For any registration period,a registration start date before the reference date and no end date,or an end date after the reference date.\",\n      \"match\": [\n        {\n          \"name\": \"Registered GMS services on the reference date\",\n          \"property\": [\n            {\n              \"@id\": \"http://endhealth.info/im#gpRegistration\",\n              \"match\": {\n                \"bool\": \"and\",\n                \"property\": [\n                  {\n                    \"@id\": \"http://endhealth.info/im#gpPatientType\",\n                    \"is\": [\n                      {\n                        \"@id\": \"http://endhealth.info/im#2751000252106\",\n                        \"name\": \"Regular GMS patient\"\n                      }\n                    ]\n                  },\n                  {\n                    \"@id\": \"http://endhealth.info/im#effectiveDate\",\n                    \"operator\": \"<=\",\n                    \"relativeTo\": {\n                      \"parameter\": \"$referenceDate\"\n                    }\n                  },\n                  {\n                    \"bool\": \"or\",\n                    \"property\": [\n                      {\n                        \"@id\": \"http://endhealth.info/im#endDate\",\n                        \"isNull\": true\n                      },\n                      {\n                        \"@id\": \"http://endhealth.info/im#endDate\",\n                        \"operator\": \">\",\n                        \"relativeTo\": {\n                          \"parameter\": \"$referenceDate\"\n                        }\n                      }\n                    ]\n                  }\n                ],\n                \"typeOf\": {\n                  \"@id\": \"http://endhealth.info/im#GPRegistration\"\n                }\n              }\n            }\n          ]\n        }\n      ],\n      \"typeOf\": {\n        \"@id\": \"http://endhealth.info/im#Patient\"\n      }\n    }"
  },
  "Q_Diabetics": {
    "http://endhealth.info/im#definition": "{\n\"@id\": \n\"http://endhealth.info/im#Q_Diabetics\",\n\"name\": \n\"Patients with active diabetes\",\n\"match\": \n[\n{\n\"property\": \n[\n{\n\"@id\": \n\"http://endhealth.info/im#observation\",\n\"match\": \n{\n\"bool\": \n\"and\",\n\"property\": \n[\n{\n\"@id\": \n\"http://endhealth.info/im#concept\",\n\"name\": \n\"concept\",\n\"is\": \n[\n{\n\"@id\": \n\"http://snomed.info/sct#73211009\",\n\"name\": \n\"Diabetes mellitus\",\n\"descendantsOrSelfOf\": \ntrue\n},\n{\n\"@id\": \n\"http://snomed.info/sct#315051004\",\n\"name\": \n\"Diabetes resolved\",\n\"descendantsOrSelfOf\": \ntrue\n}\n],\n\"valueLabel\": \n\"Diabetes mellitus or Diabetes resolved\"\n}\n],\n\"orderBy\": \n{\n\"property\": \n[\n{\n\"@id\": \n\"http://endhealth.info/im#effectiveDate\",\n\"direction\": \n\"descending\"\n}\n],\n\"limit\": \n1\n},\n\"typeOf\": \n{\n\"@id\": \n\"http://endhealth.info/im#Observation\"\n},\n\"then\": \n{\n\"property\": \n[\n{\n\"@id\": \n\"http://endhealth.info/im#concept\",\n\"is\": \n[\n{\n\"@id\": \n\"http://snomed.info/sct#73211009\",\n\"name\": \n\"Diabetes mellitus\",\n\"descendantsOrSelfOf\": \ntrue\n}\n]\n}\n]\n}\n}\n}\n]\n}\n],\n\"typeOf\": \n{\n\"@id\": \n\"http://endhealth.info/im#Patient\"\n}\n}"
  },
  "Q_Hypertensives": {
    "http://endhealth.info/im#definition": "{\n\"@id\": \n\"http://endhealth.info/im#Q_Hypertensives\",\n\"name\": \n\"Patients with active hypertension\",\n\"match\": \n[\n{\n\"property\": \n[\n{\n\"@id\": \n\"http://endhealth.info/im#observation\",\n\"match\": \n{\n\"bool\": \n\"and\",\n\"property\": \n[\n{\n\"@id\": \n\"http://endhealth.info/im#concept\",\n\"name\": \n\"concept\",\n\"is\": \n[\n{\n\"@id\": \n\"http://snomed.info/sct#70995007\",\n\"name\": \n\"Hypertension\",\n\"descendantsOrSelfOf\": \ntrue\n},\n{\n\"@id\": \n\"http://snomed.info/sct#162659009\",\n\"name\": \n\"Hypertension resolved\",\n\"descendantsOrSelfOf\": \ntrue\n}\n],\n\"valueLabel\": \n\"Hypertension or Hypertension resolved\"\n}\n],\n\"orderBy\": \n{\n\"property\": \n[\n{\n\"@id\": \n\"http://endhealth.info/im#effectiveDate\",\n\"direction\": \n\"descending\"\n}\n],\n\"limit\": \n1\n},\n\"typeOf\": \n{\n\"@id\": \n\"http://endhealth.info/im#Observation\"\n},\n\"then\": \n{\n\"property\": \n[\n{\n\"@id\": \n\"http://endhealth.info/im#concept\",\n\"is\": \n[\n{\n\"@id\": \n\"http://snomed.info/sct#70995007\",\n\"name\": \n\"Hypertension\",\n\"descendantsOrSelfOf\": \ntrue\n}\n]\n}\n]\n}\n}\n}\n]\n}\n],\n\"typeOf\": \n{\n\"@id\": \n\"http://endhealth.info/im#Patient\"\n}\n}"
  },
  "SQL" : "CREATE TABLE qry_2db5b8f6146941f298c1d222b3514388 AS\nWITH patient1 AS (\n  SELECT patient1.*\n  FROM patient AS patient1\n  JOIN query_result patient1_rslt ON patient1_rslt.id = patient1.id\n  WHERE patient1_rslt.iri = 'http://endhealth.info/im#Q_RegisteredGMS'\n),\npatient3 AS (\n  SELECT patient3.*\n  FROM patient AS patient3\n  WHERE (now() - INTERVAL '65 YEARS') >= (jdt(patient3.json ->> 'dateOfBirth'))\n  AND (now() - INTERVAL '70 YEARS') < (jdt(patient3.json ->> 'dateOfBirth'))\n),\npatient4 AS (\n  SELECT patient4.*\n  FROM patient AS patient4\n  JOIN query_result patient4_rslt ON patient4_rslt.id = patient4.id\n  WHERE patient4_rslt.iri = 'http://endhealth.info/im#Q_Diabetics'\n),\npatient5_sub6 AS (\n  SELECT patient5_sub6.*\n  FROM event AS patient5_sub6\n  JOIN tct AS tct_0 ON tct_0.child = ((patient5_sub6.json ->> 'concept')::VARCHAR)\n  WHERE ((patient5_sub6.json ->> '_type')::VARCHAR) = 'Observation'\n  AND (\n  tct_0.iri = 'http://snomed.info/sct#714628002')\n  \n),\npatient5 AS (\n  SELECT patient5.*\n  FROM patient AS patient5\n  JOIN patient5_sub6 ON ((patient5_sub6.json ->> 'patient')::UUID) = patient5.id\n),\npatient2 AS (\n  SELECT patient2.*\n  FROM patient AS patient2\n  LEFT JOIN patient3 ON patient3.id = patient2.id\n  LEFT JOIN patient4 ON patient4.id = patient2.id\n  LEFT JOIN patient5 ON patient5.id = patient2.id\n  WHERE patient3.id IS NOT NULL\n  OR patient4.id IS NOT NULL\n  OR patient5.id IS NOT NULL\n),\npatient7_sub8_inner AS (\n  SELECT patient7_sub8_inner.*\n  FROM event AS patient7_sub8_inner\n  JOIN tct AS tct_0 ON tct_0.child = ((patient7_sub8_inner.json ->> 'concept')::VARCHAR)\n  WHERE ((patient7_sub8_inner.json ->> '_type')::VARCHAR) = 'Observation'\n  AND (\n  tct_0.iri IN ('http://snomed.info/sct#271649006',\n  'http://endhealth.info/emis#1994021000006104')\n  AND (jdt(patient7_sub8_inner.json -> 'effectiveDate' ->> 'dateTime')) >= ($referenceDate + INTERVAL '-12 MONTHS'))\n  ),\npatient7_sub8_part AS (\n  SELECT *, ROW_NUMBER() OVER (PARTITION BY ((json ->> 'patient')::UUID) ORDER BY (jdt(patient7_sub8_part.json -> 'effectiveDate' ->> 'dateTime')) DESC) AS rn\n  FROM patient7_sub8_inner AS patient7_sub8_part\n),\nhighBPReading AS ( WITH patient7_sub8_part9 AS (\n    SELECT patient7_sub8_part9.*\n    FROM patient7_sub8_part AS patient7_sub8_part9\n    JOIN tct AS tct_0 ON tct_0.child = ((patient7_sub8_part9.json ->> 'concept')::VARCHAR)\n    WHERE tct_0.iri = 'http://snomed.info/sct#271649006'\n    AND ((patient7_sub8_part9.json ->> 'value')::INT) > 140\n  ),\n  patient7_sub8_part10 AS (\n    SELECT patient7_sub8_part10.*\n    FROM patient7_sub8_part AS patient7_sub8_part10\n    JOIN tct AS tct_0 ON tct_0.child = ((patient7_sub8_part10.json ->> 'concept')::VARCHAR)\n    WHERE tct_0.iri = 'http://endhealth.info/emis#1994021000006104'\n    AND ((patient7_sub8_part10.json ->> 'value')::INT) > 130\n  )\n  SELECT highBPReading.*\n  FROM patient7_sub8_part AS highBPReading\n  LEFT JOIN patient7_sub8_part9 ON patient7_sub8_part9.id = highBPReading.id\n  LEFT JOIN patient7_sub8_part10 ON patient7_sub8_part10.id = highBPReading.id\n  WHERE patient7_sub8_part9.id IS NOT NULL\n  OR patient7_sub8_part10.id IS NOT NULL )\n,\npatient7_sub8 AS (\n  SELECT patient7_sub8.*\n  FROM patient7_sub8_part AS patient7_sub8\n  WHERE rn = 1\n),\npatient7 AS (\n  SELECT patient7.*\n  FROM patient AS patient7\n  JOIN patient7_sub8 ON ((patient7_sub8.json ->> 'patient')::UUID) = patient7.id\n),\npatient11_sub12 AS (\n  SELECT patient11_sub12.*\n  FROM event AS patient11_sub12\n  JOIN highBPReading ON highBPReading.id = patient11_sub12.id\n  WHERE ((patient11_sub12.json ->> '_type')::VARCHAR) = 'Observation'\n  AND (\n  ((patient11_sub12.json ->> 'concept')::VARCHAR) = 'http://endhealth.info/im#InvitedForScreening'\n  \n  AND (jdt(patient11_sub12.json -> 'effectiveDate' ->> 'dateTime')) >= (jdt(highBPReading.json -> 'effectiveDate' ->> 'dateTime')))\n  \n),\npatient11 AS (\n  SELECT patient11.*\n  FROM patient AS patient11\n  JOIN patient11_sub12 ON ((patient11_sub12.json ->> 'patient')::UUID) = patient11.id\n),\npatient13 AS (\n  SELECT patient13.*\n  FROM patient AS patient13\n  JOIN query_result patient13_rslt ON patient13_rslt.id = patient13.id\n  WHERE patient13_rslt.iri = 'http://endhealth.info/im#Q_Hypertensives'\n)\nSELECT patient0.*\nFROM patient AS patient0\nJOIN patient1 ON patient1.id = patient0.id\nJOIN patient2 ON patient2.id = patient0.id\nJOIN patient7 ON patient7.id = patient0.id\nLEFT JOIN patient11 ON patient11.id = patient0.id\nLEFT JOIN patient13 ON patient13.id = patient0.id\nWHERE patient11.id IS NULL\nAND patient13.id IS NULL"
}

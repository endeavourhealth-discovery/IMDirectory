/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/6.7.1/samples
 */
plugins {
    id 'groovy-gradle-plugin'
    id "org.sonarqube" version "3.5.0.2730"
}

repositories {
    // Use the plugin portal to apply community plugins in convention plugins.
    gradlePluginPortal()
}

def sonarLogin= System.getenv('SONAR_LOGIN')

sonar {
    properties {
        property 'sonar.projectKey', 'endeavourhealth-discovery_IM'
        property 'sonar.organization', 'endeavourhealth-discovery'
        property 'sonar.login', sonarLogin
        property 'sonar.host.url', 'https://sonarcloud.io'
    }
}

clean.doLast {
    file('ui/coverage').deleteDir()
    file('ui/dist').deleteDir()
    file('node_api/coverage').deleteDir()
    file('node_api/dist').deleteDir()
}

println 'Build environment = [' + env + ']'

if (env == 'prod') {
    check.finalizedBy 'sonar'
}

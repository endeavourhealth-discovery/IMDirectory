{
  "typeTables": {
    "http://endhealth.info/im#Patient": {
      "table": "patient",
      "fields": {
        "http://endhealth.info/im#age": { "field": "(jdt({alias}.json ->> 'dateOfBirth'))", "type": "date" },
        "http://endhealth.info/im#dateOfBirth": { "field": "(jdt({alias}.json ->> 'dateOfBirth'))", "type": "date" }
      }
    },
    "http://endhealth.info/im#Address": {
      "table": "address",
      "fields": {
      },
      "relationships": {
        "http://endhealth.info/im#Patient": {"fromField": "id", "toField": "(({alias}.json ->> 'homeAddress')::UUID)"}
      }
    },
    "http://endhealth.info/im#GPRegistration": {
      "table": "event",
      "condition": "(({alias}.json ->> '_type')::VARCHAR) = 'EpisodeOfCare'",
      "fields": {
        "http://endhealth.info/im#concept": { "field": "(({alias}.json ->> 'concept')::VARCHAR)", "type": "iri" },
        "http://endhealth.info/im#gpPatientType": { "field": "(({alias}.json ->> 'patientType')::VARCHAR)", "type": "iri" },
        "http://endhealth.info/im#gpRegisteredStatus": { "field": "(({alias}.json ->> 'status')::VARCHAR)", "type": "iri" },
        "http://endhealth.info/im#gpGMSRegistrationDate": { "field": "(jdt({alias}.json -> 'effectiveDate' ->> 'dateTime'))", "type": "date" },
        "http://endhealth.info/im#effectiveDate": { "field": "(jdt({alias}.json -> 'effectiveDate' ->> 'dateTime'))", "type": "date" },
        "http://endhealth.info/im#endDate": { "field": "(({alias}.json ->> 'endDate')::DATE)", "type": "date" }
      },
      "relationships": {
        "http://endhealth.info/im#Patient": {"fromField": "(({alias}.json ->> 'patient')::UUID)", "toField": "id"}
      }
    },
    "http://endhealth.info/im#GPRegistrationEpisode": {
      "table": "event",
      "condition": "(({alias}.json ->> '_type')::VARCHAR) = 'EpisodeOfCare'",
      "fields": {
        "http://endhealth.info/im#concept": { "field": "(({alias}.json ->> 'concept')::VARCHAR)", "type": "iri" },
        "http://endhealth.info/im#gpPatientType": { "field": "(({alias}.json ->> 'patientType')::VARCHAR)", "type": "iri" },
        "http://endhealth.info/im#gpRegisteredStatus": { "field": "(({alias}.json ->> 'status')::VARCHAR)", "type": "iri" },
        "http://endhealth.info/im#gpGMSRegistrationDate": { "field": "(jdt({alias}.json -> 'effectiveDate' ->> 'dateTime'))", "type": "date" },
        "http://endhealth.info/im#effectiveDate": { "field": "(jdt({alias}.json -> 'effectiveDate' ->> 'dateTime'))", "type": "date" },
        "http://endhealth.info/im#endDate": { "field": "(({alias}.json ->> 'endDate')::DATE)", "type": "date" }
      },
      "relationships": {
        "http://endhealth.info/im#Patient": {"fromField": "(({alias}.json ->> 'patient')::UUID)", "toField": "id"}
      }
    },
    "http://endhealth.info/im#Observation": {
      "table": "event",
      "condition": "(({alias}.json ->> '_type')::VARCHAR) = 'Observation'",
      "fields": {
        "http://endhealth.info/im#concept": { "field": "(({alias}.json ->> 'concept')::VARCHAR)", "type": "iri" },
        "http://endhealth.info/im#effectiveDate": { "field": "(jdt({alias}.json -> 'effectiveDate' ->> 'dateTime'))", "type": "date" },
        "http://endhealth.info/im#numericValue": { "field": "(({alias}.json ->> 'value')::INT)", "type": "number" },
        "http://endhealth.info/im#ageAtEvent": { "field": "{alias}_subsel.ageAtEvent", "type": "age", "join": "JOIN (SELECT e.id, DATE_PART('year', AGE(jdt(e.json -> 'effectiveDate' ->> 'dateTime'), jdt(p.json -> 'dateOfBirth' ->> 'dateTime'))) AS ageAtEvent\n\t  FROM patient p \n\t  JOIN event e ON p.id = ((e.json ->> 'patient')::UUID)) AS {{alias}}_subsel ON {{alias}}_subsel.id = {{alias}}.id" }
      },
      "relationships": {
        "http://endhealth.info/im#Patient": {"fromField": "(({alias}.json ->> 'patient')::UUID)", "toField": "id"}
      }
    },
    "http://endhealth.info/im#Prescription": {
      "table": "event",
      "condition": "(({alias}.json ->> '_type')::VARCHAR) = 'MedicationRequest'",
      "fields": {
        "http://endhealth.info/im#concept": { "field": "(({alias}.json ->> 'concept')::VARCHAR)", "type": "iri" },
        "http://endhealth.info/im#effectiveDate": { "field": "(jdt({alias}.json -> 'effectiveDate' ->> 'dateTime'))", "type": "date" }
      },
      "relationships": {
        "http://endhealth.info/im#Patient": {"fromField": "(({alias}.json ->> 'patient')::UUID)", "toField": "id"}
      }
    }
  }
}
